# 프런트엔드 품질 원칙

UI뿐 아니라 전반적인 프런트엔드 구현/리팩토링 시 지켜야 할 최소 원칙과 체크리스트입니다. 모든 새 코드와 변경에 우선 적용합니다.

## 적용 우선순위 가이드

- **즉시 적용 (낮은 비용/높은 효익)**: 단일 스키마로 상태·쿼리·요약 일원화, 메타 정의→공통 컴포넌트, 토큰 단일 소스화, 구조 커밋→기능 커밋 분리, 자가 체크리스트 적용.
- **중간 단계**: API 호출/사이드 이펙트를 훅·서비스로 하향 이동, 에러/로딩/빈 상태 공통화, 공통 로거 연동 검토.
- **장기/선택적**: 접근성 전반 스캔(aria/포커스/키보드), 인터랙션/E2E 테스트 확대.

## 1. 아키텍처/레이어링

- **표현 ↔ 상태 ↔ 서비스 분리**: 시각적 컴포넌트(프레젠테이션)와 상태 훅/컨테이너, API/유틸 레이어를 분리한다. 사이드 이펙트(API 호출, 스토리지 접근, window 사용)는 서비스/훅 레이어에만 허용한다.
- **데이터 흐름 명시**: fetch/caching/key 생성은 서비스/훅에서 담당, UI는 결과만 소비. SSR/CSR 여부와 캐시 태그/쿼리 키를 코드로 드러내기. 페이지/컨테이너는 Suspense 경계와 상태 조합에 집중한다.
- **도메인 메타 정의**: 테이블/폼/필터/정렬/툴팁은 메타(정의 객체) → 공통 컴포넌트 패턴을 기본으로 한다. 예: `[{ key, label, width, align, sortable, tooltip, type }]`.

## 2. 상태·쿼리·요약 일원화

- URL 파라미터 ↔ 내부 상태 ↔ 요약/캐시 태그는 단일 정의에서 파생시키고, 중복 문자열을 없앤다.
- **단일 스키마**: URL 파라미터/필터 상태는 단일 타입/스키마(zod 등)로 파싱/검증하고, 캐시 키·요약·API 파라미터 생성에 재사용한다.
- 필터/정렬/쿼리 문자열은 매퍼 함수로 생성해 캐시 태그, 요약, 검증에 재사용한다.

## 3. UI/레이아웃 토큰화

- 반복되는 폭/정렬/여백/색상/폰트는 상수나 토큰으로 묶어 메타 정의와 공유한다.
- **단일 토큰 소스**: 레이아웃/색상/폰트/간격 토큰은 하나의 테마/Config(Tailwind config 등)에서만 정의한다. 숫자/색상 하드코딩은 금지하고 토큰으로 승격한다.
- 로딩/에러/빈 상태는 공통 컴포넌트로 제공하고, 메타(컬럼 수/정렬 등)에 따라 자동 렌더링하게 한다.
- 툴팁/포털/스크롤 패턴(예: `overflow-x-auto` 부모 + `overflow-visible` 자식) 등 레이아웃 관성을 공통 래퍼로 제공한다.

## 4. 에러·빌드 가드·로그

- API 실패 시 표준화된 빈 상태/에러 메시지를 사용하고, UI가 침묵하지 않게 한다.
- 빌드/SSG 시 외부 API 호출 500을 막기 위해 환경변수 체크나 모킹 가이드를 명시한다.
- 사용자 노출과 별개로 중요 오류(데이터 불일치/예외)는 공통 로거(Sentry 등)로 모두 수집한다.

## 5. 접근성/동작 원칙

- 모든 인터랙션 요소는 의미 있는 HTML 요소(button/a/input 등)로 구현한다.
- label이 필요한 요소는 항상 `<label htmlFor>` 혹은 `aria-label`을 제공한다.
- 정렬/토글 등 상태 변화는 색상뿐 아니라 텍스트/아이콘(↑/↓, On/Off 등)으로도 표현한다.
- 포커스 가능/키보드 조작 가능하게 만들고, 툴팁/모달은 포털과 ARIA 속성을 기본 적용한다.

## 6. 테스트/검증

- 핵심 플로우는 단위 테스트 + API/훅 테스트로 커버하고, 캐시 키/파라미터 검증 로직을 테스트에 포함한다.
- 최소 범위 권장: 비즈니스 로직 1개(파라미터→쿼리/캐시 키/검증), 렌더링/훅 1개(로딩/성공/에러 분기), 복잡한 폼/테이블은 인터랙션/E2E 1개 이상.
- 빌드/타입 검증은 기본으로 실행하며, 외부 의존성(API 키 등) 부재 시 동작을 명확히 한다.

## 7. 작업 플로우

- **구조 먼저**: 기능 추가 전에 필요한 공통화/메타 정의/토큰화부터 잡는 “구조 커밋” → 그 위에 “기능 커밋” 순서로 진행한다.
  - 예) 구조: `feat: extract trade table meta & tokens` → 기능: `feat: add trade PnL column with filters`
- **자가 체크(필수)**
  - 메타 정의 기반 렌더인가? (테이블/필터/툴팁/로딩 등)
  - 상태/쿼리/요약/캐시 태그가 한 소스(스키마/매퍼)에서 파생되는가?
  - 스타일/레이아웃 토큰을 썼고 매직 넘버/색을 제거했는가?
  - 로딩/에러/빈 상태가 공통 컴포넌트인가?
  - 클릭/토글/정렬 요소가 키보드/스크린리더로 이해 가능한가?
  - 핵심 로직/훅/렌더링 테스트가 최소 1개 이상 있는가?
  - 외부 의존성(API 키/환경변수) 부재 시 동작이 코드/README에 명시되어 있는가?
