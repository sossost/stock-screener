# Architecture Decision Record: 매매일지 페이지 성능 개선

**Feature**: trades-page-performance  
**Created**: 2025-12-05  
**Status**: ✅ Completed

---

## ADR-001: Suspense 사용 결정

**상태**: ✅ Accepted  
**날짜**: 2025-12-05

### 컨텍스트

매매일지 페이지 첫 접속 시 페이지 전환 지연. 서버에서 모든 데이터를 가져올 때까지 블로킹되어 사용자 경험 저하.

### 결정

Suspense 추가로 로딩 상태 표시.

### 옵션 고려

#### 옵션 1: Suspense 사용 (선택됨)
- **장점**:
  - 프로젝트의 다른 페이지들과 일관된 패턴
  - Next.js 15 App Router의 표준 방식
  - 즉시 로딩 상태 표시 가능
- **단점**: 없음

#### 옵션 2: 클라이언트 사이드 로딩
- **장점**: 없음
- **단점**:
  - 서버 컴포넌트 패턴과 불일치
  - 추가 상태 관리 필요
  - 프로젝트 패턴과 불일치

### 결과

Suspense로 로딩 스켈레톤 표시. 프로젝트의 다른 페이지들(`stats/page.tsx`, `page.tsx`)과 일관된 패턴 유지.

---

## ADR-002: 쿼리 최적화 방법 결정

**상태**: ✅ Accepted  
**날짜**: 2025-12-05

### 컨텍스트

`getTradesList`에서 최신 가격과 전일 가격을 2번의 쿼리로 조회, 전일 가격 쿼리가 중첩 서브쿼리로 비효율적.

### 결정

윈도우 함수(`ROW_NUMBER()`)로 한 번의 쿼리로 최신 가격과 전일 가격 조회.

### 옵션 고려

#### 옵션 1: 윈도우 함수 사용 (선택됨)
- **장점**:
  - 쿼리 수 감소 (2번 → 1번)
  - 중첩 서브쿼리 제거로 실행 계획 최적화
  - PostgreSQL에서 효율적으로 실행됨
- **단점**: 없음

#### 옵션 2: 기존 쿼리 유지
- **장점**: 변경 없음
- **단점**:
  - 성능 개선 없음
  - 중첩 서브쿼리로 인한 성능 저하 지속

#### 옵션 3: 애플리케이션 레벨에서 처리
- **장점**: 없음
- **단점**:
  - 데이터베이스에서 처리하는 것이 더 효율적
  - 불필요한 데이터 전송

### 결과

윈도우 함수로 쿼리 최적화. 데이터베이스 레벨에서 효율적으로 처리되어 쿼리 실행 시간 단축.

---

## ADR-003: 로딩 스켈레톤 디자인 결정

**상태**: ✅ Accepted  
**날짜**: 2025-12-05

### 컨텍스트

Suspense의 fallback으로 사용할 로딩 스켈레톤 설계 필요.

### 결정

실제 렌더링과 동일한 높이/레이아웃을 가진 스켈레톤 사용.

### 옵션 고려

#### 옵션 1: 실제 레이아웃과 동일한 스켈레톤 (선택됨)
- **장점**:
  - 레이아웃 시프트 방지
  - 프로젝트 룰 준수 (스켈레톤 원칙)
  - 사용자 경험 개선
- **단점**: 없음

#### 옵션 2: 간단한 스피너
- **장점**: 구현 간단
- **단점**:
  - 레이아웃 시프트 발생
  - 프로젝트 룰 위반
  - 사용자 경험 저하

### 결과

실제 렌더링과 동일한 높이/레이아웃을 가진 스켈레톤 사용. 프로젝트 룰 준수 및 레이아웃 시프트 방지.

