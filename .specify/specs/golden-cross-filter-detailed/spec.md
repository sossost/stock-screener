# Feature Specification: 골든크로스 필터 세분화 및 UX 개선

**Feature Branch**: `feature/golden-cross-filter-detailed`  
**Created**: 2025-11-08  
**Status**: Completed

## User Scenarios & Testing _(mandatory)_

### User Story 1 - 이평선 정배열 필터 토글 (Priority: P1)

사용자가 이평선 정배열(MA20 > MA50 > MA100 > MA200) 여부를 토글식으로 선택할 수 있어야 합니다. 현재는 항상 정배열 조건이 적용되지만, 이를 선택 가능한 필터로 변경하여 정배열 조건을 적용하거나 해제할 수 있어야 합니다.

**Why this priority**:

- 유연한 스크리닝: 정배열 조건 없이도 다른 필터로 종목 검색 가능
- 사용자 선택권 확대: 필요에 따라 정배열 조건을 선택적으로 적용
- 기존 기능 확장: 현재 기능을 유지하면서 새로운 옵션 추가

**Independent Test**:
정배열 필터를 켜고 끄면서 결과가 달라지는지, 그리고 다른 필터들과 조합하여 사용할 수 있는지 확인

**Acceptance Scenarios**:

1. **Given** 메인 페이지에서, **When** 정배열 필터를 활성화, **Then** MA20 > MA50 > MA100 > MA200 조건을 만족하는 종목만 표시됨
2. **Given** 메인 페이지에서, **When** 정배열 필터를 비활성화, **Then** 정배열 조건 없이 다른 필터만 적용된 종목이 표시됨
3. **Given** 정배열 필터가 비활성화된 상태에서, **When** 성장성 필터나 수익성 필터만 적용, **Then** 해당 조건만 만족하는 종목이 표시됨

---

### User Story 2 - 골든크로스 필터 분리 (Priority: P1)

사용자가 골든크로스(MA50 > MA200) 조건을 별도로 선택할 수 있어야 합니다. 이평선 정배열과는 독립적으로 골든크로스 조건만 적용하거나, 두 조건을 조합하여 사용할 수 있어야 합니다.

**Why this priority**:

- 골든크로스는 중요한 기술적 지표로, 이평선 정배열과는 별도로 사용되는 경우가 많음
- 다양한 투자 전략 지원: 골든크로스만 확인하거나, 정배열과 골든크로스를 함께 확인
- 기존 기능 확장: 골든크로스를 독립적인 필터로 제공하여 더 유연한 스크리닝 가능

**Independent Test**:
골든크로스 필터를 켜고 끄면서 결과가 달라지는지, 그리고 이평선 정배열 필터와 조합하여 사용할 수 있는지 확인

**Acceptance Scenarios**:

1. **Given** 메인 페이지에서, **When** 골든크로스 필터만 활성화, **Then** MA50 > MA200 조건을 만족하는 종목만 표시됨
2. **Given** 메인 페이지에서, **When** 골든크로스 필터와 정배열 필터를 모두 활성화, **Then** 두 조건을 모두 만족하는 종목만 표시됨
3. **Given** 메인 페이지에서, **When** 골든크로스 필터를 비활성화하고 정배열 필터만 활성화, **Then** 정배열 조건만 만족하는 종목이 표시됨

---

### User Story 3 - 필터박스 UX 개선 (Priority: P1)

사용자가 필터박스를 한눈에 보고 현재 적용된 필터를 확인할 수 있어야 하며, 필터박스를 클릭하면 팝업으로 상세 설정을 할 수 있어야 합니다. 현재는 모든 필터가 화면에 표시되어 공간을 많이 차지하므로, 필터박스 형태로 압축하고 팝업으로 상세 설정을 제공합니다.

**Why this priority**:

- 화면 공간 효율성: 필터가 많아질수록 화면 공간을 많이 차지하는 문제 해결
- 사용자 경험 개선: 현재 적용된 필터를 한눈에 확인하고, 필요할 때만 상세 설정 접근
- 확장성: 향후 필터가 추가되어도 UI가 복잡해지지 않음

**Independent Test**:
필터박스에 현재 적용된 필터가 올바르게 표시되는지, 그리고 팝업에서 필터를 변경하면 결과가 업데이트되는지 확인

**Acceptance Scenarios**:

1. **Given** 메인 페이지에서, **When** 필터가 적용된 상태, **Then** 필터박스에 현재 적용된 필터가 요약되어 표시됨 (예: "MA20, MA50, 골든크로스, 매출 성장")
2. **Given** 메인 페이지에서, **When** 필터박스를 클릭, **Then** 필터 설정 팝업이 열리고 모든 필터 옵션이 표시됨
3. **Given** 필터 설정 팝업에서, **When** 필터를 변경하고 적용 버튼 클릭, **Then** 팝업이 닫히고 결과가 업데이트됨
4. **Given** 필터 설정 팝업에서, **When** 취소 버튼 클릭, **Then** 팝업이 닫히고 변경사항이 적용되지 않음
5. **Given** 필터 설정 팝업에서, **When** 초기화 버튼 클릭, **Then** 모든 필터가 기본값으로 리셋됨

---

### Edge Cases

- 정배열 필터를 비활성화하고 골든크로스 필터만 활성화하면 어떻게 동작하는가?
  - 골든크로스 필터만 적용되어 MA50 > MA200 조건을 만족하는 종목만 표시됨
- 정배열 필터와 골든크로스 필터를 모두 비활성화하면 어떻게 동작하는가?
  - 이평선 관련 조건 없이 다른 필터(성장성, 수익성 등)만 적용됨
- 필터박스에 표시할 수 있는 필터가 너무 많으면 어떻게 표시하는가?
  - 필터 개수가 많으면 "N개 필터 적용" 형태로 표시하고, 호버 시 툴팁으로 상세 정보 표시
- 필터 설정 팝업에서 필터를 변경했지만 적용하지 않고 닫으면 어떻게 동작하는가?
  - 변경사항이 취소되고 기존 필터 상태가 유지됨

## Requirements _(mandatory)_

### Functional Requirements

- **FR-001**: 시스템은 이평선 정배열(MA20 > MA50 > MA100 > MA200) 여부를 토글식으로 선택할 수 있는 필터를 제공해야 함
- **FR-002**: 시스템은 골든크로스(MA50 > MA200) 조건을 별도로 선택할 수 있는 필터를 제공해야 함
- **FR-003**: 시스템은 정배열 필터와 골든크로스 필터를 독립적으로 또는 조합하여 사용할 수 있어야 함
- **FR-004**: 시스템은 필터박스에 현재 적용된 필터를 요약하여 표시해야 함
- **FR-005**: 시스템은 필터박스 클릭 시 필터 설정 팝업을 표시해야 함
- **FR-006**: 시스템은 필터 설정 팝업에서 모든 필터 옵션을 설정할 수 있어야 함
- **FR-007**: 시스템은 필터 설정 팝업에서 변경사항을 적용하거나 취소할 수 있어야 함
- **FR-008**: 시스템은 필터 설정 팝업에서 모든 필터를 초기화할 수 있어야 함
- **FR-009**: 시스템은 API 엔드포인트에 정배열 필터와 골든크로스 필터 파라미터를 추가해야 함
- **FR-010**: 시스템은 필터 상태를 URL 쿼리 파라미터로 관리해야 함

### Key Entities

- **MA Filter State**: 이평선 필터 상태를 관리하는 엔티티

  - `ordered`: boolean (MA20 > MA50 > MA100 > MA200 정배열 조건 적용 여부)
  - `goldenCross`: boolean (MA50 > MA200 조건 적용 여부)

- **Filter Summary**: 필터박스에 표시할 요약 정보

  - 활성화된 필터 목록
  - 필터 개수
  - 필터 상태 요약 텍스트

- **API Request Parameters**: API 요청 파라미터
  - `ordered`: boolean (MA20 > MA50 > MA100 > MA200 정배열 조건 적용 여부)
  - `goldenCross`: boolean (MA50 > MA200 조건 적용 여부)
  - 기존 파라미터들 유지

## Success Criteria _(mandatory)_

### Measurable Outcomes

- **SC-001**: 정배열 필터를 켜고 끌 수 있으며, 결과가 2초 이내에 업데이트됨
- **SC-002**: 골든크로스 필터를 독립적으로 켜고 끌 수 있으며, 정배열 필터와 조합하여 사용 가능함
- **SC-003**: 필터박스에 현재 적용된 필터가 1초 이내에 표시됨
- **SC-004**: 필터 설정 팝업이 0.5초 이내에 열리고 닫힘
- **SC-005**: 필터 설정 팝업에서 필터를 변경하고 적용하면 결과가 2초 이내에 업데이트됨
- **SC-006**: 기존 필터 기능들(성장성, 수익성 등)이 모두 정상 작동하며 성능 저하가 없음
- **SC-007**: 모든 필터 상태가 URL 쿼리 파라미터로 올바르게 저장되고 복원됨
- **SC-008**: 모든 기존 테스트 케이스가 통과하며, 새로운 테스트 케이스가 추가됨
