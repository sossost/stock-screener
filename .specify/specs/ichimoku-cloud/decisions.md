# Architecture Decision Record: 일목균형표

**Feature**: ichimoku-cloud  
**Created**: 2025-12-08  
**Status**: ✅ Completed

---

## ADR-001: 프론트엔드 계산 결정

**상태**: ✅ Accepted  
**날짜**: 2025-12-08

### 컨텍스트

일목균형표를 종목 상세 페이지 차트에 추가. 계산 방식을 결정해야 함.

### 결정

프론트엔드에서 실시간 계산. ETL로 사전 계산하지 않음.

### 옵션 고려

#### 옵션 1: 프론트엔드 계산 (선택됨)
- **장점**:
  - 기존 RSI/MACD 패턴과 일관성 유지
  - ETL 파이프라인 추가 불필요
  - DB 스키마 변경 불필요
  - 계산 시간이 짧아 성능 영향 미미 (1-3ms)
- **단점**: 없음

#### 옵션 2: ETL로 사전 계산
- **장점**: 없음
- **단점**:
  - ETL 파이프라인 추가 필요
  - DB 스키마 변경 필요 (daily_ma 테이블 확장 또는 새 테이블)
  - 계산 복잡도가 낮아 ETL 이점 없음
  - 기존 패턴과 불일치

### 결과

프론트엔드에서 `calculateIchimokuWithTime()` 함수로 계산. `useMemo`로 최적화하여 성능 영향 최소화.

---

## ADR-002: 후행스팬 제외 결정

**상태**: ✅ Accepted  
**날짜**: 2025-12-08

### 컨텍스트

일목균형표 구성 요소 중 후행스팬 표시 여부 결정 필요.

### 결정

후행스팬 제외. 전환선, 기준선, 선행스팬 A/B로 구성된 구름대만 표시.

### 옵션 고려

#### 옵션 1: 후행스팬 제외 (선택됨)
- **장점**:
  - 차트 복잡도 감소
  - 구름대 중심의 분석에 집중
  - 구현 단순화
- **단점**: 없음

#### 옵션 2: 후행스팬 포함
- **장점**: 완전한 일목균형표 표시
- **단점**:
  - 차트 복잡도 증가
  - 후행스팬은 26일 뒤로 이동하여 현재 가격과 겹쳐 보기 어려움
  - 구현 복잡도 증가

### 결과

후행스팬 제외. 구름대(선행스팬 A/B)만 표시하여 차트 가독성 유지. 전환선과 기준선도 제외하여 구름대에 집중.

---

## ADR-003: 구름대 색상 결정

**상태**: ✅ Accepted  
**날짜**: 2025-12-08

### 컨텍스트

일목균형표 구름대 색상 결정 필요.

### 결정

선행스팬 A > B면 초록색, A < B면 빨간색. 반투명 처리로 기존 차트와 구분.

### 옵션 고려

#### 옵션 1: A > B 초록, A < B 빨강 (선택됨)
- **장점**:
  - 표준 일목균형표 컨벤션 준수
  - 직관적 (초록=상승, 빨강=하락)
  - 반투명 처리로 기존 차트와 구분
- **단점**: 없음

#### 옵션 2: 단일 색상
- **장점**: 구현 간단
- **단점**:
  - 상승/하락 구분 어려움
  - 표준 컨벤션과 불일치

### 결과

A > B면 초록색 (`#22c55e40`), A < B면 빨간색 (`#ef444440`). 반투명 처리(25% 투명도)로 기존 차트와 구분.

---

## ADR-004: 최소 데이터 요구사항 결정

**상태**: ✅ Accepted  
**날짜**: 2025-12-08

### 컨텍스트

일목균형표 계산을 위한 최소 데이터 요구사항 결정 필요.

### 결정

최소 52일 이상의 가격 데이터 필요. 부족 시 일목균형표 표시 안 함.

### 옵션 고려

#### 옵션 1: 52일 요구사항 (선택됨)
- **장점**:
  - 선행스팬 B 계산에 52일 필요 (표준)
  - 정확한 일목균형표 계산 보장
- **단점**: 없음

#### 옵션 2: 부분 계산 (예: 26일만 있어도 전환선/기준선만 표시)
- **장점**: 데이터 부족 시에도 일부 표시 가능
- **단점**:
  - 불완전한 일목균형표로 혼란 가능
  - 구현 복잡도 증가

### 결과

최소 52일 데이터 요구사항. 부족 시 일목균형표 전체를 표시하지 않음. 사용자에게 명확한 피드백 제공.

---

## ADR-005: 전환선/기준선 제외 결정

**상태**: ✅ Accepted  
**날짜**: 2025-12-08

### 컨텍스트

일목균형표 구성 요소 중 전환선(전환선)과 기준선(기준선) 표시 여부 결정 필요.

### 결정

전환선과 기준선 제외. 구름대(선행스팬 A/B)만 표시하여 차트 가독성 향상.

### 옵션 고려

#### 옵션 1: 전환선/기준선 제외 (선택됨)
- **장점**:
  - 차트 복잡도 감소
  - 구름대 중심의 분석에 집중
  - 이동평균선과 중복 표시 방지
- **단점**: 없음

#### 옵션 2: 전환선/기준선 포함
- **장점**: 완전한 일목균형표 표시
- **단점**:
  - 차트 복잡도 증가
  - 이동평균선과 겹쳐 보기 어려움
  - 구름대 분석에 집중하기 어려움

### 결과

전환선과 기준선 제외. 구름대(선행스팬 A/B)만 표시하여 차트 가독성 향상.

---

## ADR-006: 차트 표시 기간 제한 결정

**상태**: ✅ Accepted  
**날짜**: 2025-12-08

### 컨텍스트

일목균형표가 차트에서 잘리는 문제 발생. 차트 표시 기간 제한 필요.

### 결정

차트 표시 기간을 최근 6개월(약 126 거래일)로 제한하여 일목균형표가 완전히 표시되도록 함.

### 옵션 고려

#### 옵션 1: 최근 6개월 제한 (선택됨)
- **장점**:
  - 일목균형표가 완전히 표시됨
  - 최근 데이터에 집중
  - 차트 가독성 향상
- **단점**: 없음

#### 옵션 2: 전체 기간 표시
- **장점**: 전체 데이터 확인 가능
- **단점**:
  - 일목균형표가 잘림
  - 차트 가독성 저하

### 결과

차트 표시 기간을 최근 6개월로 제한. `setVisibleLogicalRange`를 사용하여 모든 차트(메인, RSI, MACD)에 동일한 시간 범위 적용.

---

## ADR-007: x축 라벨 형식 결정

**상태**: ✅ Accepted  
**날짜**: 2025-12-08

### 컨텍스트

x축 라벨에 "~일" 표시가 포함되어 있어 간결성 개선 필요.

### 결정

x축 라벨 형식을 "월/일" 형식으로 변경하여 "~일" 표시 제거.

### 옵션 고려

#### 옵션 1: "월/일" 형식 (선택됨)
- **장점**:
  - 간결한 표시
  - 가독성 향상
- **단점**: 없음

#### 옵션 2: 기존 형식 유지
- **장점**: 없음
- **단점**:
  - 불필요한 "~일" 표시
  - 가독성 저하

### 결과

x축 라벨 형식을 "월/일" 형식으로 변경. `timeFormatter`를 사용하여 MACD 차트에 적용.


