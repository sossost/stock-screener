# RS 컬럼 추가 및 테이블 정렬 스펙

## 목표
- 가격 ETL에서 RS(Relative Strength) 점수를 산출·저장하고 스크리너 테이블에 노출한다.
- 테이블 헤더 클릭으로 주요 컬럼(포함: RS) 정렬을 지원한다.

## 정의·범위
- RS 정의: 12M/6M/3M 수익률을 각각 퍼센타일(0~100)로 계산 후 가중합(0.2*RS12 + 0.3*RS6 + 0.5*RS3)으로 `rs_score` 저장. 세 창 중 하나라도 데이터 부족 시 `rs_score = NULL`.
- 스케일: 0~100 (IBD 유사 1~99 대신 0~100 사용).
- 벤치마크: 별도 초과수익 조정 없음(절대 퍼센타일).
- 범위: 테이블 컬럼 추가 + 정렬, RS 필터/차트는 제외.

## 데이터 모델 / 마이그레이션
- 가격 메트릭 테이블(현재 일일 가격 저장 테이블)에 `rs_score INT NULL` 컬럼 추가.
- 인덱스: `(rs_score)` 또는 `(rs_score, date)` 검토(정렬/필터 대비).
- 마이그레이션 파일 추가 후 `yarn db:push` 적용 경로 안내.

## ETL / 백필
- 일일 가격 ETL 완료 후 RS 계산 스텝 추가:
  - 동일 기준일의 모든 티커에 대해 12M 수익률 계산 → 퍼센타일 산출 → `rs_score` 업데이트/삽입.
  - 데이터 부족(12M 미만)은 건너뛰고 로그에 집계.
- 백필 커맨드 추가: `yarn etl:rs-backfill` (최근 1년치 기준일 반복 계산).
- 로깅: 계산 건수/스킵/에러를 콘솔 또는 로그 테이블에 출력.

## API / UI
- API 응답에 `rs_score` 포함(기존 스크리너 데이터 소스).
- 테이블: RS 컬럼 추가(0~100, 결측은 `-`, 색상/배지 등 간결 표현).
- 정렬:
  - 헤더 클릭 시 오름/내림 토글, 정렬 중인 컬럼에 아이콘(▲/▼) 표시.
  - 정렬 키에 RS 포함(기본 정렬 기준은 기존 로직 유지/명시).

## 예시 / 수락 기준
- 마이그레이션 적용 후 컬럼 존재 확인.
- ETL 실행 시 RS가 채워지고 12M 미만 티커는 `NULL`.
- 백필 커맨드 실행 시 최근 1년치 RS 채워짐(샘플 티커로 spot-check).
- API 응답에 `rs_score` 필드 포함, 테이블에서 RS 값 렌더.
- 테이블 헤더 클릭 시 RS 오름/내림 정렬 동작, 아이콘 표기.

## 비기능 / 제약
- Node 20/22 호환 유지(현 Node 23은 `--ignore-engines` 필요).
- 쿼리 단일 조회(무N+1), 정렬 성능 고려해 인덱스 추가 검토.
- 외부 의존/새 API 호출 없음(기존 가격 데이터로 계산).
